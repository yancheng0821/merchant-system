# NO SHOW 业务逻辑说明

## 什么是 NO SHOW？

NO SHOW（未到）是指客户预约了服务但在预约时间没有出现的情况。

## NO SHOW 的触发条件

### 1. 手动标记
- **操作人员**：前台员工或管理员
- **操作时机**：任何时候都可以手动标记
- **操作条件**：只有 `CONFIRMED` 状态的预约才能标记为 `NO_SHOW`
- **操作位置**：预约管理界面 → 预约操作菜单 → "标记为未到"

### 2. 自动标记
- **触发时机**：预约时间过后 24 小时
- **检查频率**：每 1 小时检查一次
- **自动条件**：
  - 预约状态为 `CONFIRMED`
  - 当前时间 > 预约时间 + 24小时
- **系统行为**：
  - 自动将状态更新为 `NO_SHOW`
  - 在备注中添加 "[系统自动标记：预约时间过后24小时未到]"
  - 记录更新时间

## NO SHOW 的影响

### 1. 对客户的影响
- 预约记录显示为 "未到" 状态
- 可能影响客户的信用记录（如果实现了信用系统）
- 可能产生取消费用（根据商家政策）

### 2. 对商家的影响
- 时间段被浪费，影响收入
- 可以用于分析客户行为模式
- 帮助优化预约政策

## 相关配置

### 时间配置
- **自动标记延迟**：24小时（可配置）
- **检查频率**：1小时（可配置）

### 状态流转
```
CONFIRMED → NO_SHOW (手动或自动)
CONFIRMED → COMPLETED (手动)
CONFIRMED → CANCELLED (手动)
NO_SHOW → COMPLETED (手动，员工补救操作)
NO_SHOW → CANCELLED (手动，员工补救操作)
```

### 补救机制
由于员工可能忘记操作或系统自动标记错误，NO_SHOW状态的预约仍然支持：
- **标记为完成**：如果客户实际上已经接受了服务
- **标记为取消**：如果需要正式取消预约

## 预防措施

### 1. 预约提醒
- 预约前 24 小时发送提醒
- 预约前 1 小时发送提醒
- 支持短信和邮件提醒

### 2. 确认机制
- 客户可以在线确认预约
- 电话确认预约

## 统计和报告

### 1. NO SHOW 率统计
- 按时间段统计 NO SHOW 率
- 按客户统计 NO SHOW 频率
- 按服务类型统计 NO SHOW 率

### 2. 改进建议
- 分析 NO SHOW 模式
- 优化预约政策
- 改进客户沟通

## 技术实现

### 1. 定时任务
- 使用 Spring 的 `@Scheduled` 注解
- 每 1 小时执行一次检查
- 异常处理和日志记录

### 2. 数据库设计
- 状态字段：`status ENUM('CONFIRMED', 'COMPLETED', 'CANCELLED', 'NO_SHOW')`
- 备注字段：记录标记原因
- 时间字段：记录创建和更新时间

### 3. 前端界面
- 状态筛选：支持按 NO_SHOW 状态筛选
- 操作菜单：手动标记为 NO_SHOW
- 状态显示：橙色标签显示 NO_SHOW 状态